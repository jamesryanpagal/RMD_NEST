// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ROLE {
  ADMIN
  SECRETARY
}

enum STATUS {
  ACTIVE
  DELETED
}

enum CONTRACT_STATUS {
  ON_GOING
  FORFEITED
  DONE
  DELETED
}

enum LOT_STATUS {
  OPEN
  PENDING
  ON_GOING
  CLOSED
  SOLD
  DELETED
}

enum PHASE_STATUS {
  ACTIVE
  INACTIVE
  DELETED
  FULL_SLOT
}

enum MISCELLANEOUS {
  ZERO
  TEN
}

enum COMMISSION {
  FIVE
  SEVEN
  TEN
  TWELVE
  FIFTEEN
}

enum MODE_OF_PAYMENT {
  CASH
  GCASH
  ONLINE_BANKING
  CHEQUE
}

enum PAYMENT_TYPE {
  CASH
  INSTALLMENT
}

enum TRANSACTION_TYPE {
  HOLDING_FEE
  RESERVATION_FEE
  PARTIAL_DOWN_PAYMENT
  FULL_DOWN_PAYMENT
  MONTHLY_PAYMENT
  TCP_FULL_PAYMENT
  DOWN_PAYMENT
  SURVEY_FEE
}

enum DOWN_PAYMENT_TYPE {
  FULL_DOWN_PAYMENT
  PARTIAL_DOWN_PAYMENT
}

enum RESERVATION_STATUS {
  ACTIVE
  FORFEITED
  DONE
  DELETED
}

enum DOWN_PAYMENT_STATUS {
  ON_GOING
  FORFEITED
  DONE
}

enum PLATFORM {
  WEB
  MOBILE
}

enum PAYMENT_TARGET {
  MONTHLY_CONTRACT
  MONTHLY_CONTRACT_DOWN_PAYMENT
}

model User {
  id         String  @id @default(cuid())
  firstName  String
  middleName String?
  lastName   String
  email      String
  password   String
  phone      String?
  mobile     String

  houseNumber String?
  street      String
  barangay    String
  subdivision String?
  city        String
  province    String?
  region      String
  zip         String?

  role ROLE

  admin       Admin?
  secretary   Secretary?
  authSession AuthSession[]

  status STATUS @default(ACTIVE)

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model AuthSession {
  id         String  @id @default(cuid())
  userId     String
  token_hash String?

  user User @relation(fields: [userId], references: [id])

  expiration DateTime?

  created_by  String?
  modified_by String?
  deleted_by  String?

  created_date  DateTime  @default(now())
  modified_date DateTime  @updatedAt
  deleted_date  DateTime?
}

model Admin {
  id           String  @id @default(cuid())
  userId       String  @unique
  isSuperAdmin Boolean @default(false)
  accessLevel  Int[]

  user User @relation(fields: [userId], references: [id])

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Secretary {
  id          String @id @default(cuid())
  userId      String @unique
  accessLevel Int[]

  user User @relation(fields: [userId], references: [id])

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Client {
  id            String  @id @default(cuid())
  firstName     String
  middleName    String?
  lastName      String
  email         String
  contactNumber String
  tinNumber     String

  houseNumber String?
  street      String
  barangay    String
  subdivision String?
  city        String
  province    String?
  region      String
  zip         String?

  project  UserProject[]
  contract Contract[]

  reservation Reservation[]

  status STATUS @default(ACTIVE)

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Project {
  id          String  @id @default(cuid())
  projectName String
  description String?

  houseNumber String?
  street      String
  barangay    String
  subdivision String?
  city        String
  province    String?
  region      String
  zip         String?

  client UserProject[]
  phase  Phase[]

  status STATUS @default(ACTIVE)

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Contract {
  id       String @id @default(cuid())
  clientId String
  lotId    String

  sqmPrice                Float
  downPaymentType         DOWN_PAYMENT_TYPE?
  downPaymentStatus       DOWN_PAYMENT_STATUS?
  totalMonthlyDown        Float?
  totalMonthly            Float?
  downPayment             Int?
  totalDownPayment        Float?
  totalDownPaymentBalance Float?
  downPaymentTerms        Int?
  terms                   Int?
  miscellaneous           MISCELLANEOUS
  miscellaneousTotal      Float
  agentCommission         COMMISSION
  agentCommissionTotal    Float
  balance                 Float
  totalLotPrice           Float
  tcp                     Float
  paymentType             PAYMENT_TYPE
  recurringPaymentDay     Int?
  nextPaymentDate         DateTime?

  client  Client?   @relation(fields: [clientId], references: [id])
  lot     Lot?      @relation(fields: [lotId], references: [id])
  payment Payment[]
  agent   Agent?

  status CONTRACT_STATUS @default(ON_GOING)

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Phase {
  id        String @id @default(cuid())
  projectId String

  title  String
  status PHASE_STATUS @default(ACTIVE)

  project Project @relation(fields: [projectId], references: [id])
  block   Block[]

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Block {
  id      String @id @default(cuid())
  phaseId String
  title   String

  status STATUS @default(ACTIVE)

  phase Phase @relation(fields: [phaseId], references: [id])
  lot   Lot[]

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Lot {
  id      String @id @default(cuid())
  blockId String
  title   String
  sqm     Float?

  status LOT_STATUS @default(OPEN)

  block       Block         @relation(fields: [blockId], references: [id])
  contract    Contract[]
  reservation Reservation[]

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Payment {
  id            String  @id @default(cuid())
  contractId    String?
  reservationId String? @unique

  transactionType TRANSACTION_TYPE
  modeOfPayment   MODE_OF_PAYMENT
  paymentDate     String
  amount          Float
  referenceNumber String?

  contract    Contract?    @relation(fields: [contractId], references: [id])
  reservation Reservation? @relation(fields: [reservationId], references: [id])

  status STATUS @default(ACTIVE)

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Reservation {
  id       String @id @default(cuid())
  lotId    String
  clientId String

  validity DateTime

  lot     Lot      @relation(fields: [lotId], references: [id])
  client  Client   @relation(fields: [clientId], references: [id])
  payment Payment?

  status RESERVATION_STATUS @default(ACTIVE)

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

model Agent {
  id         String  @id @default(cuid())
  contractId String? @unique
  name       String
  birthDate  String?

  contract Contract? @relation(fields: [contractId], references: [id])

  status STATUS @default(ACTIVE)

  dateCreated DateTime  @default(now())
  dateUpdated DateTime  @updatedAt
  dateDeleted DateTime?
}

// JUNCTION TABLE
model UserProject {
  clientId String @unique
  client   Client @relation(fields: [clientId], references: [id])

  projectId String  @unique
  project   Project @relation(fields: [projectId], references: [id])

  @@id([clientId, projectId])
}
